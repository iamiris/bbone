define(["require","base/router","base/dataLoader","base/formatter"],function(e,t,n){var r=window.hex_md5,i=function(e){return r(e.toString())},s=function(e){return u[e]},o=function(e){return a[e]},u={},a={},f={},l={root:"/",baseUrl:"js/",defaultApp:"default",appBody:"#app-body",compileTemplate:function(e){return Handlebars.compile(e)},router:new t,getTemplateDef:function(t,n){var r=this;t=t||"";var o=i(t),u=n!=="underscore"?r.compileTemplate:_.template,a=s(o);return a||(a=$.Deferred(),typeof t=="function"?a.resolve(t):typeof t=="string"&&(r.cacheTemplate(a,o),/html$/.test(t)?e(["text!"+t],function(e){a.resolve(u(e))}):t.indexOf("#")===0?a.resolve(u($(t).html())):a.resolve(u(t)))),a},cacheTemplate:function(e,t){u[t]=e},cacheData:function(e,t){a[t]=e},log:function(){console.log.apply(console,arguments)},parseSuccessResponse:function(e){return e},parseFailureResponse:function(e){return e},appModel:new Backbone.Model,getRequestDef:function(e){var t=this,r=n.getConfig(e.id);r.paramsParser=r.paramsParser||_.identity;var s=t.parseSuccessResponse,u=t.parseFailureResponse;r.parser&&(s=u=r.parser);var a=i(JSON.stringify(_.pick(e,"id","params"))),f=o(a);if(!f){f=$.Deferred();var l=n.getRequest(e.id,r.paramsParser(e.params));l.done(function(e){var n=s(e);n.errors?f.resolve(n.errors):(t.cacheData(f,a),f.resolve(n))}),l.fail(function(e){f.resolve({errors:[{errorCode:"network issue",message:"Network failure try again later"}]})})}return f},beautifyId:function(e){return e=e.replace(/_([a-z])/g,function(e){return e.toUpperCase()}),e=e.replace(/_/g,""),e=e.replace(/([A-Z])/g,function(e){return" "+e}),e.replace(/(^.)/g,function(e){return e.toUpperCase()})},getDataIndex:function(){return a},getTemplateIndex:function(){return u},getFormatted:function(e,t,n){if(typeof t=="function")return t.apply(null,arguments);var r=c[t];return r?r(e,n):e},addFormatter:function(e,t){if(c[e])throw new Error("formatter already exist");this.setFormatter.apply(null,arguments)},setFormatter:function(e,t){c[e]=t},updateStringIndex:function(e){f=_.extend({},f,e)},getString:function(e){return f[e]?f[e]:e},getHash:i},c={};return l});