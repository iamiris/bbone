define(["require","base/router","base/dataLoader","base/util"],function(e,t,n,r){function s(e){var t,n=305419896;for(t=0;t<e.length;t++)n+=e.charCodeAt(t)*t;return n}$.browser={msie:!1};var i=window.hex_md5,o=function(e){return s(e.toString())},u=function(e){return l[e]},a=function(e){return c[e]},f=0,l={},c={},h={},p={root:"/",baseUrl:"js/",defaultApp:"default",appBody:"#app-body",compileTemplate:function(e){return Handlebars.compile(e)},router:new t,getTemplateDef:function(t,n){var r=this;t=t||"";var i=o(t),s=n!=="underscore"?r.compileTemplate:_.template,a=u(i);return a||(a=$.Deferred(),typeof t=="function"?a.resolve(t):typeof t=="string"&&(r.cacheTemplate(a,i),/html$/.test(t)?e(["text!"+t],function(e){a.resolve(s(e))}):t.indexOf("#")===0?a.resolve(s($(t).html())):a.resolve(s(t)))),a},cacheTemplate:function(e,t){l[t]=e},cacheData:function(e,t){c[t]=e},log:function(){console.log.apply(console,arguments)},responseParser:function(e){return e},appModel:new Backbone.Model,getRequestDef:function(e){var t=this,r=n.getConfig(e.id);r.paramsParser=r.paramsParser||_.identity;var i=t.responseParser;r.responseParser&&(i=r.responseParser),e.params=r.paramsParser(e.params);var s=o(JSON.stringify(_.pick(e,"id","params"))),u=a(s);if(!u){u=$.Deferred();var f=n.getRequest(e.id,e.params);f.done(function(n){var r=i(n);r.errors?u.resolve(r.errors):(e.cache==="session"&&t.cacheData(u,s),u.resolve(r))}),f.fail(function(e){u.resolve({errors:[{errorCode:"network issue",message:"Network failure try again later"}]})})}return u},beautifyId:function(e){return e=e.replace(/_([a-z])/g,function(e){return e.toUpperCase()}),e=e.replace(/_/g,""),e=e.replace(/([A-Z])/g,function(e){return" "+e}),e.replace(/(^.)/g,function(e){return e.toUpperCase()})},getDataIndex:function(){return c},getTemplateIndex:function(){return l},getFormatted:function(e,t,n){if(typeof t=="function")return t.apply(null,arguments);var r=d[t];return r?r(e,n):e},addFormatter:function(e,t){if(d[e])throw new Error("formatter already exist");this.setFormatter.apply(null,arguments)},setFormatter:function(e,t){d[e]=t},updateStringIndex:function(e){h=_.extend({},h,e)},getString:function(e){return h[e]?h[e]:e},getPageAttribute:function(e){return console.log(e,this.appModel.toJSON()),this.appModel.get(e)},getPageAttributes:function(){return this.appModel.toJSON()},getUrl:function(e){var t="#";return e.appId&&(t+=e.appId),e.pageId&&(t+="/"+e.pageId),e&&(t+="/"+r.objectToParams(_.omit(e,"appId","pageId"))),t},getHash:o,getUniqueId:function(){return"__tmp_"+p.getHash(f++)}},d={};return p});