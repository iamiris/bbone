define(["base/view","base/app","widgets/header"],function(e,t){var n,r,i=function(e,r,i){console.log("renderPage",e,r,i),n&&n.remove(),require(["apps/"+e+"/pages/"+r],function(e){var r=new e.View({model:new e.Model(i)}),s=$(t.appBody);s.empty(),s.html(r.el),r.render(),n=r})},s=e.extend({changeHandler:function(e){var t=this,s=t.model.toJSON();console.log(e),e.hasOwnProperty("appId")?require(["apps/"+s.appId],function(){require(["apps/"+s.appId+"/app"],function(e){r&&r.tearApp(),e.setupApp(function(){s.hasOwnProperty("pageId")?i(s.appId,s.pageId,s):t.model.set("pageId",e.defaultPage)}),r=e})}):e.hasOwnProperty("pageId")?require(["apps/"+s.appId+"/app"],function(n){e.pageId===undefined?(t.model.set("pageId",n.defaultPage),s=t.model.toJSON()):i(s.appId,s.pageId,s)}):n&&n.model.reset(s)}});return{View:s}});