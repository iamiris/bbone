define(["base/app","base","list","text!./messageStack/messageStack.html"],function(e,t,n,r){var i=t.util,s=t.Model.extend({initialize:function(){var e=_.bind(this.removeMessage,this),t=new a;t.on("add",function(t){var n=t.get("expires");switch(n){case-1:t.removeSelf();break;case 0:break;default:_.delay(e,n*1e3,t)}}),this.messageCollection=t},addMessage:function(e){var t=this;e.ts=(new Date).getTime(),t.messageCollection.add(e)},removeMessage:function(e){this.messageCollection.remove(e)},removeAllMessages:function(){var e=this,t=e.messageCollection.pluck("ts");_.each(t,function(t){var n=e.messageCollection.get(t);n.removeSelf()})}}),o=t.Model.extend({defaults:{expires:10,isClosable:!1,messageType:"alert"},idAttribute:"ts"}),u=t.View.extend({tagName:"li",className:"alert",template:e.compileTemplate('{{#if isClosable}}<button type="button" class="close remove_message" >&times;</button>{{/if}}{{{message}}}'),events:{"click .remove_message":"removeMessage"},removeMessage:function(){this.model.removeSelf()},postRender:function(){var e=this.model.get("messageType"),t="alert-danger";switch(e){case"warning":t="alert-warning";break;case"success":t="alert-success"}this.$el.addClass(t)}}),a=t.Collection.extend({model:o}),f=t.View.extend({initialize:function(){this.viewIndex={},this.model||(this.model=new s);var e=this.model.messageCollection;this.listenTo(e,"add remove",this.checkEmpty),this.listenTo(e,"add",this.addMessage),this.listenTo(e,"remove",this.removeMessage)},template:r,checkEmpty:function(){var e=this.model.messageCollection;e.length===0?this.$el.addClass("hide"):this.$el.removeClass("hide")},addMessage:function(e){e.toJSON||(e=new o(e));var t=e.toJSON(),n=i.createView({View:u,parentEl:"."+t.messageType+"-list",parentView:this,model:e});this.viewIndex[e.id]=n},removeMessage:function(e){var t=this.viewIndex[e.id];this.viewIndex[e.id]=null,t.remove()}});return{View:f,Model:s,MessageCollection:a}});